"use strict";(globalThis["webpackChunknlp_suggest_ui"]=globalThis["webpackChunknlp_suggest_ui"]||[]).push([[777],{2777:(t,e,n)=>{n.r(e),n.d(e,{default:()=>A});var s=n(9835),i=n(6970),o=n(1957);const l={class:"col-xs-12 col-md-6 col-lg-6"},c={class:"col-xs-12 col-md-4 col-lg-2"},u={class:"row items-center"},a=(0,s._)("div",{class:"text-h5"},"Suggestions",-1),r={class:"row items-center"};function g(t,e,n,g,d,h){const p=(0,s.up)("QuillEditor"),f=(0,s.up)("q-circular-progress"),m=(0,s.up)("q-space"),v=(0,s.up)("q-btn"),w=(0,s.up)("q-card-section"),x=(0,s.up)("q-chip"),y=(0,s.up)("q-card-actions"),S=(0,s.up)("q-slide-transition"),C=(0,s.up)("q-card"),T=(0,s.up)("q-scroll-area"),_=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(_,{class:"row justify-evenly q-pt-lg"},{default:(0,s.w5)((()=>[(0,s._)("div",l,[(0,s.Wm)(p,{options:t.options,ref:"editor",theme:"snow",content:"",contentType:"html",onClick:t.handleClick,onTextChange:t.onTextChange,style:{height:"fit-content","min-height":"300px"}},null,8,["options","onClick","onTextChange"])]),(0,s._)("div",c,[(0,s._)("div",u,[(0,s.Wm)(f,{"show-value":"",indeterminate:t.pendingChanges,class:"text-primary q-ma-md",value:t.suggestionsNum,max:t.suggestionsNum,size:"50px",color:"primary"},null,8,["indeterminate","value","max"]),a]),(0,s.Wm)(T,{class:"q-ma-md",style:{height:"80%"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.suggest,(e=>((0,s.wg)(),(0,s.iD)(s.HY,{key:e.id},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.suggestions,(n=>((0,s.wg)(),(0,s.j4)(C,{key:n.id,ref_for:!0,ref:"card",class:"q-ma-md",bordered:""},{default:(0,s.w5)((()=>[(0,s.Wm)(w,{onClick:e=>t.toggleSuggestion(n)},{default:(0,s.w5)((()=>[(0,s._)("div",r,[(0,s.Uk)((0,i.zw)(n.errorText)+" ",1),(0,s.Wm)(m),(0,s.Wm)(v,{color:"grey",round:"",flat:"",dense:"",icon:n.active?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["icon"])])])),_:2},1032,["onClick"]),(0,s.Wm)(S,null,{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("div",null,[(0,s.Wm)(y,{class:"q-pt-none"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.replacements,(o=>((0,s.wg)(),(0,s.j4)(x,{clickable:"",onClick:s=>t.applySuggestion(e,n,o),key:o,color:"primary","text-color":"white"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(o),1)])),_:2},1032,["onClick"])))),128))])),_:2},1024)],512),[[o.F8,n.active]])])),_:2},1024)])),_:2},1024)))),128))],64)))),128))])),_:1})])])),_:1})}var d=n(7364);function h(t){let e=t.text,n=0;return t.suggestions.forEach((s=>{const i=e.substring(s.start+n,s.end+n),o=`<em class="hint" data-sent-id="${t.id}" data-sugg-id="${s.id}">${i}</em>`;e=e.substring(0,s.start+n)+o+e.substring(s.end+n),n+=o.length-i.length})),e}function p(t){const e=t.map((t=>h(t)));let n="";return e.forEach((t=>{""===n||n.endsWith("\n")||"\n"===t?n+=t:n+=" "+t})),`<p>${n}</p>`}var f=n(3701);class m{constructor(t,e,n){this.id=t,this.text=e,this.suggestions=n}applySuggestion(t,e){this.text=`${this.text.substring(0,t.start)}${e}${this.text.substring(t.end,this.text.length)}`;const n=this.suggestions.findIndex((e=>e.id===t.id));this.suggestions.splice(n,1)}}var v=n(9981),w=n.n(v),x=function(t,e,n,s){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function l(t){try{u(s.next(t))}catch(e){o(e)}}function c(t){try{u(s["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(l,c)}u((s=s.apply(t,e||[])).next())}))};function y(t){return x(this,void 0,void 0,(function*(){return(yield w().post("/api/processText",{text:t})).data}))}class S{constructor(t,e,n,s,i,o){this.id=t,this.sentenceId=e,this.start=n,this.end=s,this.errorText=i,this.replacements=o,this.active=!1}}var C=function(t,e,n,s){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function l(t){try{u(s.next(t))}catch(e){o(e)}}function c(t){try{u(s["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(l,c)}u((s=s.apply(t,e||[])).next())}))};class T{static getSuggest(t){return C(this,void 0,void 0,(function*(){const e=yield y(t);let n=0;return e.map(((t,e)=>new m(e,t.text,t.suggestions.map((s=>new S(n++,e,s.start,s.end,t.text.substring(s.start,s.end),s.replacements))).sort(((t,e)=>t.start-e.start)))))}))}}var _=function(t,e,n,s){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function l(t){try{u(s.next(t))}catch(e){o(e)}}function c(t){try{u(s["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(l,c)}u((s=s.apply(t,e||[])).next())}))};const{getScrollTarget:k,setVerticalScrollPosition:Q}=f.ZP,b=(0,s.aZ)({name:"IndexPage",components:{QuillEditor:d.Bn},data:()=>({options:{modules:{toolbar:!1}},activeSuggestion:null,suggest:[],lastChangeTs:0,timer:null,pendingChanges:!1}),computed:{suggestionsNum:function(){return this.suggest.map((t=>t.suggestions.length)).reduce(((t,e)=>t+e),0)}},methods:{setSuggest(t){return _(this,void 0,void 0,(function*(){const e=this.$refs.editor;let n=0;const s=e.getQuill().getSelection(!0);null!==s&&(n=s.index);const i=e.getText().slice(0,-1),o=yield T.getSuggest(i),l=p(o);return t>=this.lastChangeTs&&(this.suggest=o,e.setContents(l,"silent"),e.getText().length<=n&&(n=e.getText().length-1),e.getQuill().focus(),e.getQuill().getSelection(!0),e.getQuill().setSelection(n,0,"silent"),!0)}))},onTextChange(){return _(this,void 0,void 0,(function*(){const t=(new Date).valueOf();null!==this.timer&&(clearTimeout(this.timer),this.timer=null),this.pendingChanges=!0,this.lastChangeTs=t,this.timer=setTimeout((()=>_(this,void 0,void 0,(function*(){const e=yield this.setSuggest(t);this.pendingChanges=!e}))),2e3)}))},toggleSuggestion(t){null!==this.activeSuggestion?this.activeSuggestion.id===t.id?(this.activeSuggestion=null,t.active=!1):(this.activeSuggestion.active=!1,this.activeSuggestion=t,this.activeSuggestion.active=!0):(this.activeSuggestion=t,this.activeSuggestion.active=!0)},scrollToElement(t){const e=k(t),n=t.offsetTop-100,s=100;Q(e,n,s)},applySuggestion(t,e,n){t.applySuggestion(e,n);const s=p(this.suggest),i=this.$refs.editor;i.setContents(s,"silent")},handleClick(t){if(t.target){const e=t.target.closest(".hint");if(null!==e){const{sentId:t,suggId:n}=e.dataset;if(void 0!==t&&void 0!==n){const e=parseInt(t),s=parseInt(n),i=this.suggest[e].suggestions.find((t=>t.id===s));void 0!==i&&(null!==this.activeSuggestion&&(this.activeSuggestion.active=!1),this.activeSuggestion=i,i.active=!0),this.scrollToElement(this.$refs.card[s].$el)}}else{const t=this.$refs.editor;t.getQuill().focus()}}}}});var q=n(1639),Z=n(9885),$=n(3302),W=n(1174),P=n(4458),I=n(3190),E=n(136),D=n(5355),j=n(9003),H=n(1821),Y=n(7691),z=n(9984),K=n.n(z);const N=(0,q.Z)(b,[["render",g]]),A=N;K()(b,"components",{QPage:Z.Z,QCircularProgress:$.Z,QScrollArea:W.Z,QCard:P.Z,QCardSection:I.Z,QSpace:E.Z,QBtn:D.Z,QSlideTransition:j.Z,QCardActions:H.Z,QChip:Y.Z})}}]);